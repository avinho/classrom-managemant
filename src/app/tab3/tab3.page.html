<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title> Alunos - Turma X</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content fullscreen>
  @if (!students) {
  <div class="spinner">
    <ion-spinner name="crescent"></ion-spinner>
  </div>
  } @else {
  <swiper-container
    [modules]="swiperModules"
    (swiperslidechange)="onSlideChange($event)"
  >
    <swiper-slide *ngFor="let student of students">
      <ion-card
        style="
          margin-top: 9px;
          border-radius: 10px;
          width: 90%;
          margin-bottom: 2px;
          box-shadow: rgba(0, 0, 0, 0.35) 0px 2px 2px;
        "
      >
        <ion-card-content style="padding: 0">
          <ion-list>
            <ion-item>
              <ion-icon name="person"></ion-icon>
              <ion-label style="margin-left: 10px"
                >{{ student.name }}</ion-label
              >
            </ion-item>
            <ion-item>
              <ion-icon name="calendar-number"></ion-icon>
              <ion-label style="margin-left: 10px">{{student.age}}</ion-label>
            </ion-item>
            <ion-item lines="none">
              <ion-icon name="school"></ion-icon>
              <ion-label style="margin-left: 10px">{{student.class}}</ion-label>
            </ion-item>
          </ion-list>
        </ion-card-content>
      </ion-card>

      <ion-list
        lines="inset"
        style="
          height: 5vh;
          align-self: flex-start;
          padding-left: 20px;
          padding-top: 5px;
          padding-bottom: 0;
          --ion-item-background: transparent;
        "
      >
        <div class="select-wrapper">
          <ion-icon name="book" style="margin-right: 5px"></ion-icon>
          <ion-select
            placeholder="Select a book"
            [selectedText]="selectedBook?.name"
            (ionChange)="onBookChange($event.detail.value)"
            interface="popover"
          >
            <ion-select-option *ngFor="let book of books" [value]="book"
              >{{ book.name }}</ion-select-option
            >
          </ion-select>
        </div>
      </ion-list>

      <cdk-virtual-scroll-viewport
        style="height: 60vh; width: 100%"
        *ngIf="student.currentBook?.lessons"
        itemSize="{{ student.currentBook.lessons?.length }}"
      >
        <ion-accordion-group expand="inset" style="padding-top: 0">
          <ion-accordion *ngFor="let lesson of student.currentBook.lessons">
            <ion-item slot="header"> {{ lesson.name }} </ion-item>
            <div slot="content" class="ion-padding">
              <ion-list>
                <ion-item *ngFor="let topic of lesson.topics">
                  <ion-toggle
                    [enableOnOffLabels]="true"
                    (ionChange)="onTopicChange(topic)"
                    [checked]="topic.done ? true : false"
                    mode="md"
                    size="small"
                    >{{ topic.name }}
                  </ion-toggle>
                </ion-item>
              </ion-list>
            </div>
          </ion-accordion>
        </ion-accordion-group>
      </cdk-virtual-scroll-viewport>
    </swiper-slide>
  </swiper-container>
  }
</ion-content>
